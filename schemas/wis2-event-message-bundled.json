{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.wmo.int/wme/1/eventMessageJSON.yaml",
  "title": "WIS2 Event Message",
  "description": "WIS2 Event Message",
  "allOf": [
    {
      "$ref": "#/definitions/Cloudevents-v1_0_2"
    },
    {
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "int.wmo.wis.wme.event"
          ]
        },
        "data": {
          "properties": {
            "conformsTo": {
              "type": "array",
              "contains": {
                "const": "http://wis.wmo.int/spec/wme/1/conf/monitoring-event-message-core"
              }
            },
            "subtype": {
              "type": "string",
              "description": "A string further describing the event type"
            },
            "severity": {
              "type": "string",
              "description": "Severity level",
              "enum": [
                "DEBUG",
                "INFO",
                "WARNING",
                "ERROR",
                "CRITICAL"
              ]
            },
            "ref": {
              "type": "string",
              "format": "uuid",
              "description": "Identifier of referenced event"
            },
            "time": {
              "type": "object",
              "description": "Time instant or interval",
              "oneOf": [
                {
                  "enum": [
                    null
                  ]
                },
                {
                  "type": "object",
                  "properties": {
                    "date": {
                      "type": "string",
                      "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
                    },
                    "timestamp": {
                      "type": "string",
                      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:\\.\\d+)?Z$"
                    },
                    "interval": {
                      "type": "array",
                      "minItems": 2,
                      "maxItems": 2,
                      "items": {
                        "oneOf": [
                          {
                            "type": "string",
                            "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
                          },
                          {
                            "type": "string",
                            "pattern": "^\\d{4}-\\d{2}$"
                          },
                          {
                            "type": "string",
                            "pattern": "^\\d{4}$"
                          },
                          {
                            "type": "string",
                            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(?:\\.\\d+)?Z$"
                          },
                          {
                            "type": "string",
                            "pattern": "^T\\d{2}(:\\d{2})?(:\\d{2})?(?:\\.\\d+)?Z$"
                          },
                          {
                            "type": "string",
                            "enum": [
                              ".."
                            ]
                          }
                        ]
                      }
                    },
                    "resolution": {
                      "type": "string",
                      "description": "Minimum time period resolvable in the dataset, as an ISO 8601 duration",
                      "pattern": "^(-?)P(?=\\\\d|T\\\\d)(?:(\\\\d+)Y)?(?:(\\\\d+)M)?(?:(\\\\d+)([DW]))?(?:T(?:(\\\\d+)H)?(?:(\\\\d+)M)?(?:(\\\\d+(?:\\\\.\\\\d+)?)S)?)?$",
                      "example": [
                        "P1D"
                      ]
                    }
                  }
                }
              ]
            },
            "content": {
              "type": "object",
              "description": "inline content of event message",
              "properties": {
                "channel": {
                  "type": "string",
                  "description": "topic that link is based on"
                },
                "title": {
                  "type": "string",
                  "description": "A human-readable name given to the resource."
                },
                "description": {
                  "type": "string",
                  "description": "A free-text account of the resource."
                }
              },
              "required": [
                "title"
              ]
            },
            "links": {
              "type": "array",
              "minItems": 1,
              "items": {
                "$schema": "https://json-schema.org/draft/2020-12/schema",
                "$id": "https://raw.githubusercontent.com/wmo-im/wcmp2/main/schema/link.yaml",
                "title": "WCMP link object definition",
                "description": "WCMP link object definition",
                "type": "object",
                "required": [
                  "href"
                ],
                "properties": {
                  "rel": {
                    "type": "string",
                    "description": "The type or semantics of the relation.",
                    "example": "alternate"
                  },
                  "type": {
                    "type": "string",
                    "description": "A hint indicating what the media type of the result of dereferencing the link should be.",
                    "example": "application/geo+json"
                  },
                  "hreflang": {
                    "type": "string",
                    "description": "A hint indicating what the language of the result of dereferencing the link should be.",
                    "example": "en"
                  },
                  "title": {
                    "type": "string",
                    "description": "Used to label the destination of a link such that it can be used as a human-readable identifier.",
                    "example": "Trierer Strasse 70, 53115 Bonn"
                  },
                  "length": {
                    "type": "integer"
                  },
                  "channel": {
                    "type": "string",
                    "description": "topic to subscribe to for broker workflow"
                  },
                  "security": {
                    "type": "object",
                    "patternProperties": {
                      "^[a-zA-Z0-9\\.\\-_]+$": {
                        "oneOf": [
                          {
                            "$ref": "#/definitions/Schema_Reference"
                          },
                          {
                            "$ref": "#/definitions/Schema_SecurityScheme"
                          }
                        ]
                      }
                    }
                  },
                  "distribution": {
                    "type": "object",
                    "description": "the additional information qualifying the service and allowing to build and display the \"access\" information in a portal",
                    "properties": {
                      "availableFormats": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "name": {
                              "type": "string",
                              "description": "available format short name."
                            },
                            "description": {
                              "type": "string",
                              "description": "the individual format description to allow building the portal information"
                            },
                            "numberOFiles": {
                              "type": "string",
                              "description": "typical number of files disseminated by the distribution mechanism over a period of time"
                            },
                            "typicalFilesize": {
                              "type": "string",
                              "description": "size of a typical individual file (e.g. KB, MB, GB)"
                            },
                            "typicalFilename": {
                              "type": "string",
                              "description": "example filename"
                            },
                            "samples": {
                              "description": "links of samples that can be openly accessed by users to provide a better understanding of the data",
                              "items": {
                                "type": "object",
                                "$ref": "#/allOf/1/properties/data/properties/links/items/properties/distribution/properties/availableFormats/items/properties/documentation/items"
                              }
                            },
                            "documentation": {
                              "type": "array",
                              "description": "links to the associated documentation available for this format when applicable",
                              "items": {
                                "allOf": [
                                  {
                                    "type": "object",
                                    "required": [
                                      "rel"
                                    ],
                                    "properties": {
                                      "rel": {
                                        "type": "string",
                                        "description": "The type or semantics of the relation.",
                                        "example": "alternate"
                                      },
                                      "type": {
                                        "type": "string",
                                        "description": "A hint indicating what the media type of the result of dereferencing the link should be.",
                                        "example": "application/geo+json"
                                      },
                                      "hreflang": {
                                        "type": "string",
                                        "description": "A hint indicating what the language of the result of dereferencing the link should be.",
                                        "example": "en"
                                      },
                                      "title": {
                                        "type": "string",
                                        "description": "Used to label the destination of a link such that it can be used as a human-readable identifier.",
                                        "example": "Trierer Strasse 70, 53115 Bonn"
                                      },
                                      "length": {
                                        "type": "integer"
                                      }
                                    }
                                  },
                                  {
                                    "type": "object",
                                    "required": [
                                      "href"
                                    ],
                                    "properties": {
                                      "href": {
                                        "type": "string",
                                        "description": "The URI of the link target.",
                                        "example": "https://data.example.com/buildings/123"
                                      }
                                    }
                                  }
                                ]
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "anyOf": [
            {
              "required": [
                "conformsTo",
                "severity",
                "content"
              ]
            },
            {
              "required": [
                "conformsTo",
                "severity",
                "links"
              ]
            }
          ]
        }
      },
      "required": [
        "datacontenttype",
        "dataschema",
        "subject",
        "time",
        "data"
      ]
    }
  ],
  "definitions": {
    "Cloudevents-v1_0_2": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "description": "CloudEvents Specification JSON Schema",
      "type": "object",
      "properties": {
        "id": {
          "description": "Identifies the event.",
          "$ref": "#/definitions/Cloudevents-v1_0_2_Iddef",
          "examples": [
            "A234-1234-1234"
          ]
        },
        "source": {
          "description": "Identifies the context in which an event happened.",
          "$ref": "#/definitions/Cloudevents-v1_0_2_Sourcedef",
          "examples": [
            "https://github.com/cloudevents",
            "mailto:cncf-wg-serverless@lists.cncf.io",
            "urn:uuid:6e8bc430-9c3a-11d9-9669-0800200c9a66",
            "cloudevents/spec/pull/123",
            "/sensors/tn-1234567/alerts",
            "1-555-123-4567"
          ]
        },
        "specversion": {
          "description": "The version of the CloudEvents specification which the event uses.",
          "$ref": "#/definitions/Cloudevents-v1_0_2_Specversiondef",
          "examples": [
            "1.0"
          ]
        },
        "type": {
          "description": "Describes the type of event related to the originating occurrence.",
          "$ref": "#/definitions/Cloudevents-v1_0_2_Typedef",
          "examples": [
            "com.github.pull_request.opened",
            "com.example.object.deleted.v2"
          ]
        },
        "datacontenttype": {
          "description": "Content type of the data value. Must adhere to RFC 2046 format.",
          "$ref": "#/definitions/Cloudevents-v1_0_2_Datacontenttypedef",
          "examples": [
            "text/xml",
            "application/json",
            "image/png",
            "multipart/form-data"
          ]
        },
        "dataschema": {
          "description": "Identifies the schema that data adheres to.",
          "$ref": "#/definitions/Cloudevents-v1_0_2_Dataschemadef"
        },
        "subject": {
          "description": "Describes the subject of the event in the context of the event producer (identified by source).",
          "$ref": "#/definitions/Cloudevents-v1_0_2_Subjectdef",
          "examples": [
            "mynewfile.jpg"
          ]
        },
        "time": {
          "description": "Timestamp of when the occurrence happened. Must adhere to RFC 3339.",
          "$ref": "#/definitions/Cloudevents-v1_0_2_Timedef",
          "examples": [
            "2018-04-05T17:31:00Z"
          ]
        },
        "data": {
          "description": "The event payload.",
          "$ref": "#/definitions/Cloudevents-v1_0_2_Datadef",
          "examples": [
            "<much wow=\"xml\"/>"
          ]
        },
        "data_base64": {
          "description": "Base64 encoded event payload. Must adhere to RFC4648.",
          "$ref": "#/definitions/Cloudevents-v1_0_2_Data_base64def",
          "examples": [
            "Zm9vYg=="
          ]
        }
      },
      "required": [
        "id",
        "source",
        "specversion",
        "type"
      ],
      "definitions": {}
    },
    "Cloudevents-v1_0_2_Data_base64def": {
      "type": [
        "string",
        "null"
      ],
      "contentEncoding": "base64"
    },
    "Cloudevents-v1_0_2_Datacontenttypedef": {
      "type": [
        "string",
        "null"
      ],
      "minLength": 1
    },
    "Cloudevents-v1_0_2_Datadef": {
      "type": [
        "object",
        "string",
        "number",
        "array",
        "boolean",
        "null"
      ]
    },
    "Cloudevents-v1_0_2_Dataschemadef": {
      "type": [
        "string",
        "null"
      ],
      "format": "uri",
      "minLength": 1
    },
    "Cloudevents-v1_0_2_Iddef": {
      "type": "string",
      "minLength": 1
    },
    "Cloudevents-v1_0_2_Sourcedef": {
      "type": "string",
      "format": "uri-reference",
      "minLength": 1
    },
    "Cloudevents-v1_0_2_Specversiondef": {
      "type": "string",
      "minLength": 1
    },
    "Cloudevents-v1_0_2_Subjectdef": {
      "type": [
        "string",
        "null"
      ],
      "minLength": 1
    },
    "Cloudevents-v1_0_2_Timedef": {
      "type": [
        "string",
        "null"
      ],
      "format": "date-time",
      "minLength": 1
    },
    "Cloudevents-v1_0_2_Typedef": {
      "type": "string",
      "minLength": 1
    },
    "Schema_APIKeySecurityScheme": {
      "type": "object",
      "required": [
        "type",
        "name",
        "in"
      ],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "apiKey"
          ]
        },
        "name": {
          "type": "string"
        },
        "in": {
          "type": "string",
          "enum": [
            "header",
            "query",
            "cookie"
          ]
        },
        "description": {
          "type": "string"
        }
      },
      "patternProperties": {
        "^x-": {}
      },
      "additionalProperties": false
    },
    "Schema_AuthorizationCodeOAuthFlow": {
      "type": "object",
      "required": [
        "authorizationUrl",
        "tokenUrl"
      ],
      "properties": {
        "authorizationUrl": {
          "type": "string",
          "format": "uri-reference"
        },
        "tokenUrl": {
          "type": "string",
          "format": "uri-reference"
        },
        "refreshUrl": {
          "type": "string",
          "format": "uri-reference"
        },
        "scopes": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        }
      },
      "patternProperties": {
        "^x-": {}
      },
      "additionalProperties": false
    },
    "Schema_ClientCredentialsFlow": {
      "type": "object",
      "required": [
        "tokenUrl"
      ],
      "properties": {
        "tokenUrl": {
          "type": "string",
          "format": "uri-reference"
        },
        "refreshUrl": {
          "type": "string",
          "format": "uri-reference"
        },
        "scopes": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        }
      },
      "patternProperties": {
        "^x-": {}
      },
      "additionalProperties": false
    },
    "Schema_HTTPSecurityScheme": {
      "type": "object",
      "required": [
        "scheme",
        "type"
      ],
      "properties": {
        "scheme": {
          "type": "string"
        },
        "bearerFormat": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": [
            "http"
          ]
        }
      },
      "patternProperties": {
        "^x-": {}
      },
      "additionalProperties": false,
      "oneOf": [
        {
          "description": "Bearer",
          "properties": {
            "scheme": {
              "enum": [
                "bearer"
              ]
            }
          }
        },
        {
          "description": "Non Bearer",
          "not": {
            "required": [
              "bearerFormat"
            ]
          },
          "properties": {
            "scheme": {
              "not": {
                "enum": [
                  "bearer"
                ]
              }
            }
          }
        }
      ]
    },
    "Schema_ImplicitOAuthFlow": {
      "type": "object",
      "required": [
        "authorizationUrl",
        "scopes"
      ],
      "properties": {
        "authorizationUrl": {
          "type": "string",
          "format": "uri-reference"
        },
        "refreshUrl": {
          "type": "string",
          "format": "uri-reference"
        },
        "scopes": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        }
      },
      "patternProperties": {
        "^x-": {}
      },
      "additionalProperties": false
    },
    "Schema_OAuth2SecurityScheme": {
      "type": "object",
      "required": [
        "type",
        "flows"
      ],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "oauth2"
          ]
        },
        "flows": {
          "$ref": "#/definitions/Schema_OAuthFlows"
        },
        "description": {
          "type": "string"
        }
      },
      "patternProperties": {
        "^x-": {}
      },
      "additionalProperties": false
    },
    "Schema_OAuthFlows": {
      "type": "object",
      "properties": {
        "implicit": {
          "$ref": "#/definitions/Schema_ImplicitOAuthFlow"
        },
        "password": {
          "$ref": "#/definitions/Schema_PasswordOAuthFlow"
        },
        "clientCredentials": {
          "$ref": "#/definitions/Schema_ClientCredentialsFlow"
        },
        "authorizationCode": {
          "$ref": "#/definitions/Schema_AuthorizationCodeOAuthFlow"
        }
      },
      "patternProperties": {
        "^x-": {}
      },
      "additionalProperties": false
    },
    "Schema_OpenIdConnectSecurityScheme": {
      "type": "object",
      "required": [
        "type",
        "openIdConnectUrl"
      ],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "openIdConnect"
          ]
        },
        "openIdConnectUrl": {
          "type": "string",
          "format": "uri-reference"
        },
        "description": {
          "type": "string"
        }
      },
      "patternProperties": {
        "^x-": {}
      },
      "additionalProperties": false
    },
    "Schema_PasswordOAuthFlow": {
      "type": "object",
      "required": [
        "tokenUrl"
      ],
      "properties": {
        "tokenUrl": {
          "type": "string",
          "format": "uri-reference"
        },
        "refreshUrl": {
          "type": "string",
          "format": "uri-reference"
        },
        "scopes": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        }
      },
      "patternProperties": {
        "^x-": {}
      },
      "additionalProperties": false
    },
    "Schema_Reference": {
      "type": "object",
      "required": [
        "$ref"
      ],
      "patternProperties": {
        "^\\$ref$": {
          "type": "string",
          "format": "uri-reference"
        }
      }
    },
    "Schema_SecurityScheme": {
      "oneOf": [
        {
          "$ref": "#/definitions/Schema_APIKeySecurityScheme"
        },
        {
          "$ref": "#/definitions/Schema_HTTPSecurityScheme"
        },
        {
          "$ref": "#/definitions/Schema_OAuth2SecurityScheme"
        },
        {
          "$ref": "#/definitions/Schema_OpenIdConnectSecurityScheme"
        }
      ]
    }
  }
}
